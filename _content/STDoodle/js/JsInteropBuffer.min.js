export function InitStreamManager(){_jsStreamManager||(_jsStreamManager=new JsStreamManager,console.log(`Stream manager has been initialised.`))}export function LoadBuffer(bufferId){InitStreamManager();_jsStreamManager.LoadBuffer(bufferId)}export function ClearBuffer(bufferId){InitStreamManager();_jsStreamManager.RemoveBuffer(bufferId)}export function ReadBuffer(bufferId,fromIndex){return InitStreamManager(),_jsStreamManager.ReadBuffer(bufferId,fromIndex)}export function BufferHasData(bufferId){return InitStreamManager(),_jsStreamManager.BufferHasData(bufferId)}export function BufferExists(bufferId){return InitStreamManager(),_jsStreamManager.BufferExists(bufferId)}export function BufferLength(bufferId){return InitStreamManager(),_jsStreamManager.BufferLength(bufferId)}export function SetLocalStorageItem(key,value){localStorage.setItem(key,value)}export function ClearLocalStorageItem(key){localStorage.setItem(key,null)}export function RemoveLocalStorageItem(key){localStorage.removeItem(key)}export function ReadLocalStorageItem(key){return localStorage.getItem(key)}export let _jsStreamManager;export class JsStreamManager{constructor(){this._buffers=[]}GetBufferByName(bufferId){try{const ix=this._buffers.findIndex(b=>b.JsBufferName==bufferId);return(()=>0)?this._buffers[ix]:null}catch(ex){return null}}GetBufferIndexByName(bufferId){try{return this._buffers.findIndex(b=>b.JsBufferName==bufferId)}catch(ex){return-1}}LoadBuffer(bufferId){const buffer=new JsStreamBuffer(bufferId);return this._buffers.push(buffer),bufferId}RemoveBuffer(bufferId){var bufferIndex=this.GetBufferIndexByName(bufferId);bufferIndex>=0?(console.log(`Buffer with Id ${bufferId} removed.`),this._buffers[bufferIndex].ClearBuffer(),this._buffers.splice(bufferIndex,1)):console.log(`Unable to clear buffer with Id ${bufferId}. Not found`)}BufferExists(bufferId){return this.GetBufferIndexByName(bufferId)>=0}BufferHasData(bufferId){const buffer=this.GetBufferByName(bufferId);return buffer!==null?buffer.BufferHasData():!1}BufferLength(bufferId){const buffer=this.GetBufferByName(bufferId);return buffer!==null?buffer.BufferLength():0}ReadBuffer(bufferId,index){const buffer=this.GetBufferByName(bufferId);return buffer!==null?buffer.ReadBuffer(index):null}}export class JsStreamBuffer{constructor(jsBufferName){this._readLength=5120;this._lsValue="";this._jsBufferName=jsBufferName}get JsBufferName(){return this._jsBufferName}RefreshBuffer(){this._lsValue="";this._buffer=new ArrayBuffer(0)}GetBufferData(){return(this._lsValue==null||this._lsValue=="")&&(this._lsValue=ReadLocalStorageItem(this._jsBufferName),this._lsValue!==""&&this.BuildBufferArray()),this._lsValue||""}BuildBufferArray(){if(this._buffer.byteLength===0)if(this._lsValue=="")this._buffer=new ArrayBuffer(0);else{const arrayData=Uint8Array.from(atob(this._lsValue),c=>c.charCodeAt(0));this._buffer=arrayData.buffer}}BufferHasData(){try{return this.RefreshBuffer(),this.GetBufferData()!=""}catch(ex){console.log(`JsStreamBuffer:BufferHasData. Error ${ex}`)}return!1}BufferLength(){try{return this.RefreshBuffer(),this.GetBufferData().length}catch(ex){return console.log(`JsStreamBuffer:BufferLength. Error ${ex}`),0}}ClearBuffer(){try{this._lsValue=null;RemoveLocalStorageItem(this._jsBufferName)}catch(ex){console.log(`JsStreamBuffer:ClearBuffer. Error ${ex}`)}}ReadBuffer(fromIndex){try{const bufferData=this.GetBufferData();if(this._buffer.byteLength===0)return"";const totalLeft=Math.min(this._readLength,this._buffer.byteLength-fromIndex),result=new Uint8Array(this._buffer,fromIndex,totalLeft);return result.toString()}catch(ex){return console.log(`JsStreamBuffer:ReadBuffer. Error ${ex}`),null}}}